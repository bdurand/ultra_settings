<% source_value = configuration.__value_from_source__(field.name, source) %>
<% source_label = source_chip_label(source) %>
<% chip_class = source_chip_class(source) %>
<% source_name = source_key_name(field, source) %>
<div class="ultra-settings-source-row<%= ' active' if current_source == source %>">
  <span class="ultra-settings-source-chip <%= chip_class %>"><%= source_label %></span>

  <% if source_name %>
    <span class="ultra-settings-source-key"><%= html_escape(source_name) %></span>
    <span class="ultra-settings-source-eq">=</span>
  <% end %>

  <% if source_value.nil? %>
    <span class="ultra-settings-source-val not-set">not set</span>
  <% elsif field.secret? %>
    <span class="ultra-settings-source-val secret"><%= html_escape(secret_value(source_value)) %></span>
  <% else %>
    <span class="ultra-settings-source-val"><%= html_escape(display_value(source_value)) %></span>
  <% end %>

  <% if current_source == source %>
    <span class="ultra-settings-source-badge ultra-settings-sb-active">&#x25CF; Active</span>
  <% elsif source_overridden_by(source, current_source) && !source_value.nil? %>
    <span class="ultra-settings-source-badge ultra-settings-sb-overridden">Overridden</span>
  <% end %>

  <% if source == :settings %>
    <% edit_url = UltraSettings.runtime_settings_url(name: field.runtime_setting, type: field.type, description: field.description) %>
    <% if edit_url %>
      <a
        href="<%= html_escape(edit_url) %>"
        class="ultra-settings-edit-link"
        title="Edit <%= html_escape(field.runtime_setting) %>"
      >
        <%= edit_icon(13) %>
      </a>
    <% end %>
  <% end %>
</div>
